---
title: Guardian Eye - 智慧門禁防禦系統

---

# Guardian Eye - 智慧門禁防禦系統

## 期末專案完整企劃書

----------

## 專案基本資訊

**專案名稱：** Guardian Eye - 基於邊緣運算的智慧門禁與反入侵系統  
**組員人數：** 4人  
**開發時間：** 2週（12/28 - 1/9）  
**展示日期：** 1/9（五）13:10-16:30  
**統編：** 92021164（國立臺北科技大學）  
**報帳上限：** NTD 500

----------

## 情境設定

### 背景故事

你家門口安裝了一套由 TX2 驅動的智慧守衛系統。近期社區出現偽裝成玩偶的竊盜集團，需要一套能夠：

1.  自動識別主人並開門
2.  偵測陌生人並通知
3.  識別偽裝入侵者（小豬玩偶）並觸發最高警報
4.  雙重驗證解除警報（防止誤觸）

### 系統運作模式

#### 模式一：日常模式

-   光敏電阻持續監測環境亮度
-   天黑時自動點亮黃色照明燈
-   待機狀態，等待訪客

#### 模式二：訪客識別模式

**偵測到人形時：**

-   啟動人臉識別系統
-   藍燈閃爍（表示 AI 運算中）

**識別結果處理：**

-   **主人**：綠燈恆亮 5 秒 → 伺服馬達開門 → 記錄日誌
-   **陌生人**：藍燈持續閃爍 → 連續拍攝 3 張照片 → Discord 推播給主人 → 門保持鎖定

#### 模式三：防禦模式（最高級別）

**偵測到小豬玩偶時：**

-   紅燈爆閃（5Hz 快速閃爍）
-   蜂鳴器全功率警報
-   Discord 立即推播最高警報
-   系統進入鎖定狀態，需雙重解鎖

### 雙重解鎖機制

**第一階段：遠端驗證（主人在外）**

1.  主人在 Discord 頻道收到警報推播
2.  輸入預設密碼（如 "1234"）
3.  Discord Bot 驗證成功後，將「遠端解鎖」狀態寫入共享儲存
4.  通知主人：「遠端驗證通過，請回家輸入現場密碼」

**第二階段：現場驗證（主人回家）**

1.  Qt 介面輪詢偵測到遠端已解鎖
2.  系統隨機生成 3 位數密碼（如 "739"）並顯示在螢幕上
3.  主人在 Qt 介面輸入該密碼
4.  驗證成功：紅燈熄滅 → 蜂鳴器關閉 → 寫入 Kernel Log → 恢復待機

**安全設計理念：**

-   單一驗證點可能被破解（如小偷強制關機或破壞設備）
-   遠端驗證確保「主人授權」
-   現場隨機密碼防止「預錄影像重放攻擊」
-   符合銀行保全系統的雙因子認證邏輯

----------

## 系統架構圖

```
┌─────────────────────────────────────────────┐
│           Qt GUI (主控制介面)                │
│  - 即時攝影機畫面 (640x480)                  │
│  - 系統狀態顯示                              │
│  - 密碼輸入框                                │
│  - 4個快捷鍵 (F1-F4)                         │
└────────┬────────────────────────────────────┘
         │
         ├──────────────────┬──────────────────┐
         ▼                  ▼                  ▼
┌─────────────────┐  ┌─────────────────┐  ┌─────────────────┐
│  AI Vision      │  │  Hardware       │  │  Kernel Driver  │
│  視覺識別引擎    │  │  Control        │  │  黑盒子記錄器    │
├─────────────────┤  │  硬體控制層      │  ├─────────────────┤
│ - YOLO 小豬偵測 │  ├─────────────────┤  │ - ioctl 寫入    │
│ - 人臉識別      │  │ - 4顆LED控制    │  │ - read 讀取     │
└─────────────────┘  │ - 伺服馬達      │  │ - 事件時間戳    │
                     │ - 蜂鳴器        │  └─────────────────┘
                     │ - MCP3008+光敏  │
                     └─────────────────┘
                              │
                              ▼
                     ┌─────────────────┐
                     │  Discord Bot    │
                     │  遠端通知與控制  │
                     ├─────────────────┤
                     │ - Webhook 推播  │
                     │ - 接收解鎖密碼  │
                     │ - 傳送照片      │
                     └─────────────────┘

```

----------

## 評分項目對照表


| 項目 | 課程要求 | 我們的實作方案 | 配分 |
|------|---------|---------------|------|
| **情境** | 需含完整情境說明 | 智慧門禁 + 反竊盜情境，符合真實應用 | - |
| **項目一** | Qt/Node.js GUI + 4快捷鍵 + 資料輸入 | ✅ Qt介面嵌入攝影機畫面<br>✅ F1-F4快捷鍵<br>✅ 密碼輸入框 | 20% |
| **項目二** | GPIO控制 ≥4顆LED，閃爍+恆亮 | ✅ 4色LED（綠/藍/紅/黃）<br>✅ 多種模式（恆亮/慢閃/快閃） | 20% |
| **項目三** | 光敏電阻 + MCP3008 + LED控制 | ✅ SPI通訊讀取光敏數值<br>✅ 自動夜燈功能 | 20% |
| **項目四** | 視覺+AI驗證，偵測動態或特定顏色 | ✅ YOLOv4-tiny 物體偵測（小豬）<br>✅ 人臉識別（主人vs陌生人） | 10% |
| **項目五** | Kernel Driver 黑盒子，ioctl+read | ✅ 記錄所有操作（開門/警報/解鎖）<br>✅ 可讀取歷史Log | 10% |
| **項目六** | 遠端協同，雙人協同+網頁按鈕+輪詢 | ✅ Discord推播警報<br>✅ 遠端輸入密碼<br>✅ Qt輪詢狀態 | 10% |
| **報告** | PPT簡報內容 + 個人心得 | ✅ 完整技術文件<br>✅ 300字以上心得 | 10% |
| **總計** | | | **100%** |

----------

##  系統狀態與視覺回饋設計

### LED 狀態定義表


| 情境 | 🟢綠燈 | 🔵藍燈 | 🔴紅燈 | 🟡黃燈 | 蜂鳴器 | 伺服馬達 | Discord |
|------|--------|--------|--------|--------|--------|----------|---------|
| 正常待機 | OFF | OFF | OFF | 亮（夜間） | OFF | 鎖定 | 無 |
| AI運算中 | OFF | 閃爍1Hz | OFF | - | OFF | 鎖定 | 無 |
| 主人驗證成功 | 恆亮5秒 | OFF | OFF | - | OFF | 開門90° | 無 |
| 陌生人 | OFF | 閃爍1Hz | OFF | - | OFF | 鎖定 | 傳照片 |
| 小豬入侵 | OFF | OFF | 爆閃5Hz | - | ON | 鎖定 | 🚨最高警報 |
| 遠端解鎖中 | OFF | OFF | 慢閃0.5Hz | - | OFF | 鎖定 | 等待現場 |
| 完全解除 | OFF | OFF | OFF | 亮（夜間） | OFF | 恢復 | 記錄事件 |

### GPIO 腳位分配

| 元件 | GPIO編號 | 說明 |
|------|---------|------|
| 綠色LED | 298 | 主人驗證成功 |
| 藍色LED | 389 | AI運算/陌生人 |
| 紅色LED | 388 | 入侵警報 |
| 黃色LED | 481 | 夜間照明 |
| 伺服馬達PWM | 32（PWM通道） | 門鎖控制 |
| 蜂鳴器 | 297（透過NPN驅動） | 警報音效 |

### 光敏電阻閾值設定
| 環境 | ADC數值範圍 | 黃燈狀態 | 說明 |
|------|------------|---------|------|
| 室內明亮 | 800-1023 | OFF | 白天，不需照明 |
| 黃昏 | 400-799 | 呼吸燈 | 過渡期，柔和照明 |
| 夜晚 | 0-399 | 全亮 | 天黑，全功率照明 |

----------

## 🤖 AI 視覺系統設計

### YOLO 訓練計畫

**目標：** 訓練 YOLOv4-tiny 模型識別小豬玩偶

**訓練集規劃：**

-   照片數量：150-200 張
-   場景多樣化：
    -   不同距離：0.5m、1m、2m
    -   不同角度：正面、側面、俯視、仰視
    -   不同光線：室內燈光、自然光、背光
    -   不同背景：白牆、木地板、門口
-   標註工具：LabelImg（產生 YOLO 格式標註檔）

**訓練參數：**

-   輸入尺寸：416×416
-   類別數量：1（pig）
-   Batch size：64
-   Epochs：6000（Early stopping 監控 mAP）
-   預訓練權重：使用 darknet53.conv.74

**預期性能：**

-   訓練時間：2-3 小時（使用桌機 GPU）
-   目標準確率：mAP > 85%
-   TX2 推理速度：5-8 FPS（416×416）

**降級方案（Plan B）：** 如果訓練失敗或時間不足：

-   使用 COCO 預訓練模型的 "teddy bear" 類別
-   或簡化為「粉紅色大面積區域偵測」（HSV 顏色過濾）

### 人臉識別系統

**技術選擇：** face_recognition 庫（基於 dlib）

**主人特徵錄入流程：**

1.  拍攝主人照片 5-10 張（不同表情、光線、角度）
2.  提取 128 維人臉特徵向量
3.  儲存為 pickle 檔案（owner_face.pkl）

**識別流程：**

1.  從攝影機擷取當前幀
2.  偵測人臉位置（face_locations）
3.  提取人臉特徵向量
4.  與預存的主人特徵比對（歐式距離）
5.  閾值判斷：
    -   距離 < 0.5 → 主人
    -   距離 ≥ 0.5 → 陌生人

**性能優化：**

-   只在 YOLO 偵測到「人」時才執行人臉識別
-   降低影像解析度到 640×480
-   每 2 幀處理一次（降低 CPU 負擔）

### 視覺系統整合邏輯

**主循環處理流程：**

```
攝影機擷取畫面
    ↓
YOLO 物體偵測
    ├─ 偵測到「小豬」
    │   └→ 立即觸發最高警報
    │      （紅燈+蜂鳴器+Discord）
    │
    └─ 偵測到「人」
        └→ 啟動人臉識別
            ├─ 主人
            │   └→ 綠燈恆亮 + 開門
            │
            └─ 陌生人
                └→ 藍燈閃爍 + 拍照 + Discord通知

```

----------

## 🔧 硬體控制系統

### 採購清單（符合報帳規定）

| 器材名稱 | 規格 | 用途 | 預估價格 | 報帳 |
| ---------- | ------------------ | ----------- | -------- | ------------ |
| SG90 伺服馬達   180度，5V供電 | 門鎖開關 | $70 | ✅            |
| 有源蜂鳴器 | Active Buzzer | 警報音效 | $25 | ✅            |
| LED 燈組 | 紅、黃、綠、藍各2顆 | 狀態指示 | $50      | ✅            |
| NPN 電晶體    | 2N3904 或 S8050     | 驅動蜂鳴器       | $20      | ✅            |
| 杜邦線        | 公對母20條、公對公10條      | 連接 TX2 與麵包板 | $60      | ✅            |
| 電阻包        | 220Ω（LED）、1kΩ（電晶體） | 限流與保護       | $30      | ✅            |
| USB WebCam | 720p，30fps         | YOLO + 人臉識別 | $400     | ❌（自費）        |
| 小豬玩偶       | 粉紅色，中型尺寸           | 訓練與展示       | $150     | ✅            |
| **報帳總計**   |                    |             | **$255** | ✅ 符合 $300 上限 |


### 實驗室借用器材（需歸還）

-   TX2 開發板 + 電源線
-   麵包板 × 1
-   MCP3008 ADC 晶片 × 1
-   光敏電阻 × 1
-   DHT11 溫濕度感測器 × 1（選用）
-   杜邦線（公對公 × 5、公對母 × 15）

### 接線注意事項

**伺服馬達供電警告：**

-   ⚠️ **絕對不可**直接從 TX2 GPIO 供電給馬達
-   馬達需接 TX2 擴充座的 **5V 專用腳位**
-   信號線（橘色）接 GPIO PWM 腳位
-   地線（棕色）接 GND

**蜂鳴器驅動設計：**

-   TX2 GPIO 輸出電流很小（<10mA），無法直接驅動蜂鳴器
-   必須使用 NPN 電晶體作為開關
-   電路：GPIO → 1kΩ電阻 → Base，Collector → 蜂鳴器 → 5V，Emitter → GND

**LED 保護電阻：**

-   每顆 LED 串聯 220Ω 電阻
-   防止電流過大燒毀 LED 或 GPIO


----------

##  Qt GUI 介面設計

### 主介面佈局

```
┌──────────────────────────────────────────┐
│  Guardian Eye - 智慧門禁系統 v1.0         │
├──────────────────────────────────────────┤
│                                          │
│   ┌──────────────────────────────┐      │
│   │                              │      │
│   │   即時攝影機畫面              │      │
│   │   (OpenCV VideoCapture)      │      │
│   │   640 × 480                  │      │
│   │                              │      │
│   │   [AI偵測結果標註]           │      │
│   └──────────────────────────────┘      │
│                                          │
│  ┌────────────────────────────────────┐  │
│  │ 系統狀態: 🟢 正常運作              │  │
│  │ 最後事件: 陌生人偵測 @ 14:23:10    │  │
│  │ 光敏數值: 245 (夜間模式)          │  │
│  └────────────────────────────────────┘  │
│                                          │
│  ┌────────────────────────────────────┐  │
│  │ 🔐 解鎖介面                        │  │
│  │                                    │  │
│  │ 遠端驗證: ❌ 未通過                │  │
│  │                                    │  │
│  │ 輸入密碼: [_______]                │  │
│  │                                    │  │
│  │ [確認] [清除] [取消]               │  │
│  └────────────────────────────────────┘  │
│                                          │
│  快捷鍵:                                 │
│  F1: 手動開門  F2: 靜音警報              │
│  F3: 系統日誌  F4: 離開程式              │
└──────────────────────────────────────────┘

```

### 快捷鍵功能

| 按鍵 | 功能   | 詳細說明                          |
| -- | ---- | ----------------------------- |
| F1 | 手動開門 | 強制伺服馬達轉動90°，綠燈亮5秒，記錄到Log      |
| F2 | 靜音警報 | 關閉蜂鳴器（紅燈繼續閃爍，等待解鎖）            |
| F3 | 查看日誌 | 從 Kernel Driver 讀取歷史記錄，彈出視窗顯示 |
| F4 | 離開程式 | 安全關閉（釋放攝影機、關閉GPIO、卸載Driver）   |

### 密碼輸入框設計

**正常模式：**

-   輸入框接受任意密碼，按下確認後透過 ioctl 發送到 Kernel Driver
-   可用於未來擴充功能（如主人身分驗證）

**警報解鎖模式：**

-   偵測到遠端驗證通過後，介面顯示隨機生成的 3 位數密碼
-   例如：「請輸入以下密碼以解除警報：**739**」
-   輸入框變更為「密碼驗證模式」，只接受該隨機碼

----------

## Kernel Driver 設計

### 黑盒子功能需求

**目的：** 記錄所有重要系統事件，類似飛機黑盒子

**需記錄的事件類型：**

1.  門禁操作：開門、關門、手動開門
2.  AI 識別結果：主人、陌生人、小豬
3.  警報事件：觸發、遠端解鎖、現場解鎖、完全解除
4.  系統錯誤：攝影機斷線、硬體故障

### Driver 架構設計

**模組名稱：** blackbox_driver.ko

**裝置節點：** /dev/blackbox

**支援操作：**

-   **open/close**：基本裝置開啟與關閉
-   **ioctl**：寫入事件（從 User Space 傳入事件資料）
-   **read**：讀取日誌（回傳 buffer 中的歷史記錄）

**ioctl 命令定義：**

```
#define LOG_EVENT   _IOW('B', 1, struct event_data)
#define CLEAR_LOG   _IO('B', 2)

struct event_data {
    char message[256];  // 事件描述
    int priority;       // 優先級（0-5）
};

```

**Buffer 管理：**

-   環形緩衝區（Circular Buffer）
-   大小：4096 bytes
-   當 buffer 滿時，覆蓋最舊的記錄

### 日誌格式範例

```
[2025-01-09 14:23:10] EVENT: AI_PROCESSING
[2025-01-09 14:23:12] EVENT: STRANGER_DETECTED (Confidence: 92%)
[2025-01-09 14:23:12] EVENT: PHOTO_CAPTURED (3 images)
[2025-01-09 14:23:13] EVENT: DISCORD_NOTIFICATION_SENT
[2025-01-09 14:25:05] EVENT: INTRUSION_DETECTED (Object: Pig)
[2025-01-09 14:25:05] EVENT: MAX_ALARM_TRIGGERED
[2025-01-09 14:25:30] EVENT: REMOTE_UNLOCK_ATTEMPT (IP: 192.168.1.100)
[2025-01-09 14:25:35] EVENT: REMOTE_UNLOCK_SUCCESS
[2025-01-09 14:28:10] EVENT: LOCAL_CODE_INPUT (Code: 739)
[2025-01-09 14:28:10] EVENT: LOCAL_CODE_VERIFIED
[2025-01-09 14:28:10] EVENT: ALARM_FULLY_DISABLED

```

----------

## Discord Bot 遠端系統

### Webhook 推播設計

**Webhook URL 取得方式：**

1.  建立 Discord 伺服器
2.  頻道設定 → 整合 → Webhook → 建立新 Webhook
3.  複製 Webhook URL（類似：https://discord.com/api/webhooks/...）

**推播訊息類型：**

**1. 陌生人警報**

```
🚪 陌生人偵測
───────────────
時間: 2025-01-09 14:23:10
位置: 前門攝影機
狀態: 門禁已鎖定

請查看附圖確認是否為訪客

```

附上 3 張連續拍攝的照片

**2. 最高級別警報**

```
🚨 ⚠️  入侵警報  ⚠️ 🚨
═══════════════════════
時間: 2025-01-09 14:25:05
威脅等級: 嚴重
偵測物體: 小豬玩偶 (置信度: 96%)

警報已觸發：
✓ 紅燈爆閃
✓ 蜂鳴器啟動
✓ 門禁鎖定

>>> 如需解除，請回覆解鎖密碼

```

### Discord Bot 互動設計

**Bot 功能：**

-   監聽指定頻道的訊息
-   驗證使用者輸入的解鎖密碼
-   將解鎖狀態寫入共享儲存（讓 Qt 輪詢讀取）

**指令格式：**

-   使用者輸入：`1234`（預設密碼）
-   Bot 驗證成功後回覆：
    
    ```
    ✅ 遠端驗證通過解鎖進度: 50%請立即返回現場輸入隨機密碼
    
    ```
    

**通訊機制：**

-   Bot 將解鎖狀態寫入檔案：`/tmp/remote_unlock_status`
-   檔案內容：`unlocked=true`
-   Qt 程式每秒輪詢該檔案

----------

## 👥 4人工作分配方案

### 模組化設計原則

**核心理念：**

-   高內聚、低耦合（每個人負責獨立模組）
-   接口先行（先定義 API，再實作）
-   並行開發（減少相互等待時間）
-   獨立測試（每個模組可單獨驗證）

### 成員 A：AI 視覺專家

**負責範圍：** YOLO 訓練 + 人臉識別系統

#### Week 1 任務清單

-   **Day 1-2**：拍攝小豬玩偶照片（150-200張）
    -   不同距離、角度、光線條件
    -   使用 LabelImg 標註 YOLO 格式
-   **Day 3-4**：訓練 YOLOv4-tiny 模型
    -   配置 darknet 訓練環境
    -   監控訓練曲線（loss、mAP）
    -   調整超參數（學習率、batch size）
-   **Day 5**：錄入主人人臉特徵
    -   拍攝主人照片 5-10 張
    -   提取 128 維特徵向量
    -   儲存為 pickle 檔案
-   **Day 6-7**：整合 YOLO + 人臉識別
    -   測試單獨運行的準確率和速度
    -   優化推理性能（降解析度、調閾值）

#### Week 2 任務清單

-   **Day 8-9**：封裝成統一 API 模組
    -   撰寫清楚的函數接口文件
    -   處理異常情況（如無法偵測）
-   **Day 10-11**：與成員 C 整合測試
    -   提供 demo 程式給成員 C
    -   根據反饋調整參數
-   **Day 12**：協助整體測試
    -   現場調整偵測靈敏度
    -   確保展示時識別穩定

#### 交付成果

1.  **程式模組**
    -   `yolo_detector.py`：YOLO 偵測接口
    -   `face_recognizer.py`：人臉識別接口
2.  **資料檔案**
    -   `pig.weights`：訓練好的 YOLO 權重
    -   `owner_face.pkl`：主人臉部特徵
3.  **文件**
    -   API 使用說明（輸入輸出格式）
    -   訓練過程報告（準確率曲線、測試結果）

#### 所需技能

-   Python 程式設計
-   機器學習基礎概念
-   耐心（標註工作很枯燥但重要）

----------

### 成員 B：硬體控制專家

**負責範圍：** GPIO、感測器、伺服馬達、蜂鳴器

#### Week 1 任務清單

-   **Day 1**：採購所有材料
    -   前往光華商場或電子材料行
    -   記得索取統編 92021164 的發票
-   **Day 2**：完成麵包板接線
    -   參考電路圖連接所有元件
    -   特別注意馬達和蜂鳴器的電源設計
-   **Day 3-4**：測試 GPIO 基本控制
    -   4 顆 LED 的閃爍、恆亮控制
    -   伺服馬達的 PWM 控制（轉動角度）
    -   蜂鳴器驅動（透過 NPN 電晶體）
-   **Day 5**：實作 MCP3008 SPI 通訊
    -   讀取光敏電阻數值
    -   測試不同光線下的 ADC 輸出
-   **Day 6-7**：整合自動照明功能
    -   設定合理的亮度閾值
    -   實現呼吸燈效果（選用）

#### Week 2 任務清單

-   **Day 8-9**：封裝硬體控制模組
    -   統一所有硬體操作接口
    -   加入錯誤處理（如 GPIO 初始化失敗）
-   **Day 10**：繪製完整接線圖
    -   使用 Fritzing 或手繪清楚標註
    -   附上材料清單與規格
-   **Day 11-12**：與成員 C 整合測試
    -   協助 Qt 程式呼叫硬體功能
    -   現場調整 LED 亮度、馬達角度

#### 交付成果

1.  **程式模組**
    -   `hardware_control.py`：硬體控制接口
        -   `init_hardware()`：初始化所有 GPIO
        -   `led_control(color, mode)`：LED 控制
        -   `open_door()`：開門動作
        -   `trigger_alarm()`：觸發警報
        -   `read_light_sensor()`：讀取光敏數值
2.  **文件**
    -   接線圖（標註所有連接）
    -   元件清單與採購收據
    -   硬體測試報告

#### 所需技能

-   Python 程式設計
-   基礎電路知識（看懂接線圖）
-   動手能力強（接線、焊接）

----------

### 成員 C：Qt GUI 整合者（主程式）

**負責範圍：** Qt 介面 + 主邏輯整合 + 系統協調

#### Week 1 任務清單

-   **Day 1-2**：設計 Qt 介面佈局
    -   使用 Qt Designer 或直接寫程式碼
    -   建立主視窗框架
-   **Day 3-4**：實作攝影機畫面顯示
    -   OpenCV VideoCapture 讀取影像
    -   轉換為 QImage 並顯示在 QLabel
    -   測試畫面流暢度（目標 30fps）
-   **Day 5-6**：實作 4 個快捷鍵
    -   建立 QShortcut 綁定 F1-F4
    -   先做基本功能框架（如按鈕回應）
-   **Day 7**：設計密碼輸入介面
    -   建立 QLineEdit 和驗證邏輯
    -   準備接收隨機密碼顯示

#### Week 2 任務清單

-   **Day 8-9**：整合成員 A 的 AI 模組
    -   在主循環呼叫 YOLO 和人臉識別
    -   根據偵測結果觸發對應動作
-   **Day 10**：整合成員 B 的硬體模組
    -   根據 AI 結果控制 LED、馬達
    -   測試完整流程（偵測→顯示→控制）
-   **Day 11**：實作輪詢機制
    -   使用 QTimer 每秒檢查遠端解鎖狀態
    -   實現隨機密碼生成與驗證
-   **Day 12**：整合測試與 Debug
    -   協調所有成員進行聯合測試
    -   修復整合過程中的問題

#### 交付成果

1.  **程式模組**
    -   `main_gui.py` 或 `main_gui.cpp`：主程式
    -   完整的 Qt 介面
2.  **文件**
    -   系統架構圖
    -   狀態機流程圖
    -   各模組整合說明

#### 所需技能

-   C++ 或 Python（取決於 Qt 綁定選擇）
-   Qt 框架基礎
-   系統整合思維（協調各模組）

----------

### 成員 D：系統底層專家

**負責範圍：** Kernel Driver + Discord Bot + 遠端通訊

#### Week 1 任務清單

-   **Day 1-3**：撰寫 Kernel Driver
    -   建立字元裝置驅動程式框架
    -   實作 ioctl（接收事件並寫入 buffer）
    -   實作 read（讀取歷史記錄）
-   **Day 4-5**：編譯與測試 Driver
    -   使用 Makefile 編譯 .ko 模組
    -   載入模組：`sudo insmod blackbox_driver.ko`
    -   撰寫測試程式驗證讀寫功能
-   **Day 6-7**：設計日誌格式
    -   加入時間戳記功能
    -   設計事件優先級分類

#### Week 2 任務清單

-   **Day 8**：建立 Discord Webhook
    -   註冊 Discord 伺服器與頻道
    -   取得 Webhook URL
    -   測試發送文字與圖片
-   **Day 9-10**：開發 Discord Bot
    -   使用 discord.py 建立 Bot
    -   監聽頻道訊息
    -   實作密碼驗證邏輯
-   **Day 11**：實作 Bot 與 Qt 通訊
    -   選擇通訊方式（檔案、socket、共享記憶體）
    -   撰寫測試腳本驗證雙向通訊
-   **Day 12**：整合測試
    -   與成員 C 協調整合
    -   測試完整的雙重解鎖流程

#### 交付成果

1.  **程式模組**
    -   `blackbox_driver.ko`：Kernel Driver 模組
    -   `discord_bot.py`：Discord Bot 程式
2.  **文件**
    -   Kernel Driver 原始碼與註解
    -   ioctl 命令定義文件
    -   Discord Bot 設定說明
    -   通訊協定規格

#### 所需技能

-   C 語言（Kernel Driver）
-   Linux Kernel 基礎
-   Python（Discord Bot）
-   網路通訊概念

----------

## 🔗 跨模組接口定義（重要！）

為確保 4 人可以並行開發，必須預先定義清楚的接口規範。

### 接口 1：AI 模組 → Qt 主程式

**提供者：** 成員 A  
**使用者：** 成員 C

**函數規格：**

#### detect_objects(frame)

-   **輸入**：OpenCV 影像矩陣（numpy.ndarray）
-   **輸出**：字典列表
    
    ```python
    [    {        'class': 'pig',        'confidence': 0.96,        'bbox': [x1, y1, x2, y2]    },    {        'class': 'person',        'confidence': 0.89,        'bbox': [x1, y1, x2, y2]    }]
    
    ```
    
-   **異常處理**：無物體時返回空列表 `[]`

#### recognize_face(frame)

-   **輸入**：OpenCV 影像矩陣
-   **輸出**：字串
    -   `"OWNER"`：識別為主人
    -   `"STRANGER"`：識別為陌生人
    -   `"NO_FACE"`：未偵測到人臉
-   **異常處理**：模型載入失敗時返回 `"ERROR"`

----------

### 接口 2：硬體模組 → Qt 主程式

**提供者：** 成員 B  
**使用者：** 成員 C

**函數規格：**

#### init_hardware()

-   **功能**：初始化所有 GPIO 與 SPI
-   **返回**：布林值（成功/失敗）

#### led_control(color, mode)

-   **參數**：
    -   `color`：字串（"green", "blue", "red", "yellow"）
    -   `mode`：字串（"on", "off", "blink_slow", "blink_fast"）
-   **返回**：無

#### open_door()

-   **功能**：伺服馬達轉動 90 度，5 秒後復位
-   **返回**：無

#### trigger_alarm()

-   **功能**：蜂鳴器啟動
-   **返回**：無

#### stop_alarm()

-   **功能**：蜂鳴器關閉
-   **返回**：無

#### read_light_sensor()

-   **功能**：讀取光敏電阻 ADC 值
-   **返回**：整數（0-1023）

----------

### 接口 3：Qt 主程式 → Kernel Driver

**提供者：** 成員 D  
**使用者：** 成員 C

**ioctl 命令規格：**

#### LOG_EVENT

-   **命令碼**：`_IOW('B', 1, struct event_data)`
-   **資料結構**：
    
    ```c
    struct event_data {    char message[256];    int priority;  // 0=INFO, 1=WARNING, 2=CRITICAL};
    
    ```
    
-   **用途**：寫入事件到黑盒子

#### CLEAR_LOG

-   **命令碼**：`_IO('B', 2)`
-   **用途**：清空所有日誌（僅管理員可用）

**read 操作規格：**

-   讀取黑盒子內容
-   返回格式：純文字，每行一筆記錄

----------

### 接口 4：Discord Bot ↔ Qt 主程式

**提供者：** 成員 D  
**使用者：** 成員 C

**通訊方式：** 檔案共享（最簡單方案）

**檔案位置：** `/tmp/remote_unlock_status`

**檔案格式：**

```
unlocked=false
code=
timestamp=0

```

**狀態變化流程：**

1.  初始狀態：`unlocked=false`
2.  Discord Bot 驗證密碼後：寫入 `unlocked=true`
3.  Qt 輪詢偵測到後：生成隨機碼，寫入 `code=739`
4.  使用者驗證成功後：刪除檔案（或寫入 `unlocked=false`）

----------

## ⏱️ 時間分配與里程碑

### Week 1（12/28 - 1/3）：獨立開發期

**目標：** 每個人完成自己的模組，可獨立測試
| 日期    | 成員A（AI）   | 成員B（硬體）   | 成員C（Qt） | 成員D（Driver+Bot） |
| ----- | --------- | --------- | ------- | --------------- |
| 12/28 | 拍攝小豬照片    | 採購材料      | 設計Qt介面  | 建立Driver框架      |
| 12/29 | 標註YOLO資料  | 完成接線      | 設計Qt介面  | 實作ioctl         |
| 12/30 | 訓練YOLO模型  | 測試LED控制   | 攝影機畫面嵌入 | 實作read          |
| 12/31 | 訓練YOLO模型  | 測試馬達蜂鳴器   | 攝影機畫面嵌入 | 編譯測試Driver      |
| 1/1   | 錄入人臉特徵    | MCP3008通訊 | 實作快捷鍵   | 測試Driver        |
| 1/2   | 整合YOLO+人臉 | 自動照明功能    | 實作快捷鍵   | 建立Discord伺服器    |
| 1/3   | 優化性能      | 封裝硬體模組    | 密碼輸入框   | Webhook測試       |


**Week 1 驗收標準：**

-   ✅ 成員A：YOLO能偵測小豬（準確率>80%），人臉識別能區分主人
-   ✅ 成員B：4顆LED可控制，馬達能轉動，光敏電阻有讀值
-   ✅ 成員C：Qt介面可顯示攝影機畫面，快捷鍵有反應
-   ✅ 成員D：Driver可載入，能寫入和讀取日誌

----------

### Week 2（1/4 - 1/9）：整合與測試期

**目標：** 整合所有模組，完成完整系統
| 日期  | 全組任務        | 重點工作               |
| --- | ----------- | ------------------ |
| 1/4 | 接口整合        | A提供API給C，B提供硬體模組給C |
| 1/5 | 接口整合        | C整合AI+硬體，初步測試      |
| 1/6 | Discord Bot | D完成Bot並測試與Qt通訊     |
| 1/7 | 雙重解鎖        | C+D整合解鎖流程，測試輪詢機制   |
| 1/8 | 完整測試        | 全組測試完整情境，修復Bug     |
| 1/9 | Demo準備      | 排練展示流程，撰寫報告        |


**Week 2 每日站立會議：**

-   時間：每天晚上 9:00（30分鐘）
-   內容：
    1.  今天完成了什麼？
    2.  遇到什麼問題？
    3.  明天計畫做什麼？

----------

## 📝 報告撰寫規範

### 小組報告（PPT 格式）

**檔名：** `Final_project_第XX組_小組報告.ppt`

**簡報內容架構：**

1.  **封面**
    -   專案名稱、組別、組員姓名學號
2.  **情境介紹**（2-3頁）
    -   背景故事
    -   系統目標
    -   使用情境示意圖
3.  **項目一：Qt GUI**（2頁）
    -   方案構思：為何選擇Qt，介面設計理念
    -   解決方法：如何嵌入攝影機、快捷鍵實作
4.  **項目二：GPIO控制**（2頁）
    -   方案構思：LED狀態設計邏輯
    -   解決方法：閃爍與恆亮的實現方式
5.  **項目三：光敏電阻**（2頁）
    -   方案構思：自動照明的觸發條件
    -   解決方法：MCP3008 SPI通訊
6.  **項目四：AI視覺**（3頁）
    -   方案構思：YOLO+人臉識別架構
    -   解決方法：訓練流程、整合策略
    -   展示訓練結果（準確率曲線）
7.  **項目五：Kernel Driver**（2頁）
    -   方案構思：黑盒子設計目的
    -   解決方法：ioctl與read實作
8.  **項目六：遠端協同**（3頁）
    -   方案構思：Discord Bot選擇理由
    -   解決方法：雙重解鎖流程
    -   展示Discord通知截圖
9.  **系統展示**（2-3頁）
    -   完整流程演示截圖
    -   接線圖與實體照片
10.  **遇到的困難與解決**（1-2頁）
11.  **結論與未來展望**（1頁）

**簡報技巧：**

-   多用圖片、流程圖，少放大段文字
-   展示實際運行畫面（錄影或GIF）
-   準備 Demo 影片（以防現場展示失敗）

----------

### 個人報告（PDF 格式）

**檔名：** `Final_project_第XX組_學號_姓名_個人報告.pdf`

**報告內容架構：**

1.  **方案構思**（1頁）
    
    -   說明你負責的項目預計使用的技術
    -   為何選擇這些技術方案
2.  **實驗步驟**（3-5頁，需附圖）
    
    -   詳細描述你的實作過程
    -   **必須包含圖片**：
        -   電路接線照片（如負責硬體）
        -   程式碼截圖（關鍵函數）
        -   測試結果截圖
    -   按照時間順序或邏輯順序描述
3.  **專案心得**（至少 300 字，以 Word 計算）
    
    -   本次專案遇到的困難
    -   如何解決這些困難
    -   學到了什麼
    -   對團隊合作的感想
    -   對課程的建議
4.  **小組分工**（1頁）
    
    -   你認為各成員的貢獻比例（例如：A 30%、B 25%、C 25%、D 20%）
    -   說明每個人負責的具體項目

**撰寫注意事項：**

-   使用客觀、專業的語氣
-   步驟描述要詳細到「別人看了能重現」
-   心得不要流水帳，要有反思
-   誠實評價小組分工（不用擔心，這不會影響組員分數）

----------

## 🎬 Demo 展示流程規劃

### 展示腳本（建議 5 分鐘）

**開場（30秒）：**

-   介紹專案名稱與情境背景
-   說明系統架構與核心功能

**情境一：主人回家（1分鐘）：**

1.  攝影機對準「主人」
2.  Qt 介面顯示「AI 運算中」（藍燈閃爍）
3.  識別為主人（綠燈恆亮）
4.  伺服馬達開門
5.  按 F3 顯示 Kernel Log（記錄開門事件）

**情境二：陌生人來訪（1.5分鐘）：**

1.  攝影機對準「陌生人」（可請助教協助）
2.  系統識別為陌生人（藍燈閃爍）
3.  自動拍攝 3 張照片
4.  Discord 即時推播通知（展示手機畫面）
5.  門保持鎖定

**情境三：入侵警報（2分鐘）：**

1.  攝影機對準「小豬玩偶」
2.  YOLO 偵測到小豬（Qt 介面顯示標註框）
3.  紅燈爆閃 + 蜂鳴器啟動
4.  Discord 推播最高警報
5.  **雙重解鎖流程：**
    -   在手機 Discord 輸入密碼 "1234"
    -   Qt 介面顯示隨機碼（如 "739"）
    -   在 Qt 輸入 "739"
    -   警報完全解除
6.  按 F3 顯示完整事件日誌

**結尾（30秒）：**

-   展示自動照明功能（遮住光敏電阻，黃燈亮起）
-   總結技術亮點

### 展示準備清單

**硬體準備：**

-   ✅ TX2 開發板（已接好所有線路）
-   ✅ USB WebCam
-   ✅ 麵包板（固定好，避免鬆動）
-   ✅ 小豬玩偶
-   ✅ 延長線（確保電源充足）

**軟體準備：**

-   ✅ 所有程式已編譯並測試
-   ✅ Discord Bot 已啟動並連線
-   ✅ Kernel Driver 已載入（`lsmod` 確認）
-   ✅ Qt 程式設為開機自動啟動

**備用方案：**

-   ✅ Demo 影片（以防現場網路或設備故障）
-   ✅ 後備 TX2（以防主機故障）
-   ✅ 熱點手機（以防教室 WiFi 不穩）

### 常見問題預演

**評審可能提問：**

1.  **「YOLO 的準確率是多少？」**
    
    -   回答：在測試集上 mAP 達到 XX%，現場展示的置信度為 XX%
2.  **「如果兩個人同時在門口怎麼辦？」**
    
    -   回答：系統會優先處理最高威脅等級（小豬>陌生人>主人）
3.  **「Discord Bot 如果斷線怎麼辦？」**
    
    -   回答：系統會記錄到本地日誌，主人回家可查看；未來可加入簡訊備援
4.  **「為何不用 LINE Bot？」**
    
    -   回答：Discord Bot 開發更簡單，推播功能完整，且不需企業認證
5.  **「如果小偷強制關機怎麼辦？」**
    
    -   回答：這是物理安全問題，超出軟體範疇；可加入 UPS 不斷電系統

----------

## ⚠️ 風險評估與應對

### 高風險項目

#### 風險 1：YOLO 訓練失敗

**發生機率：** 中等  
**影響程度：** 高（無法完成項目四）

**應對方案：**

-   **Plan A**：使用 COCO 預訓練模型的 "teddy bear" 類別
-   **Plan B**：降級為「粉紅色物體偵測」（HSV 顏色過濾）
-   **時間點**：如果 1/2 前訓練不成功，立即切換 Plan A

#### 風險 2：TX2 性能不足

**發生機率：** 中等  
**影響程度：** 中（影響流暢度）

**應對方案：**

-   降低影像解析度（640×480 → 416×416）
-   降低處理頻率（每 2 幀處理一次）
-   關閉不必要的背景服務

#### 風險 3：Discord Bot 與 Qt 通訊失敗

**發生機率：** 低  
**影響程度：** 中（無法完成項目六）

**應對方案：**

-   備用通訊方式：使用 socket 或 HTTP 請求
-   簡化設計：直接在 Discord 頻道顯示隨機碼（不需 Qt 生成）

----------

### 中風險項目

#### 風險 4：展示時硬體故障

**發生機率：** 低  
**影響程度：** 高（無法展示）

**應對方案：**

-   準備備用 TX2 與麵包板
-   錄製完整 Demo 影片
-   攜帶備用 LED、杜邦線

#### 風險 5：時間不足

**發生機率：** 中等  
**影響程度：** 高（功能不完整）

**應對方案：**

-   明確優先級：項目一、二、三 > 項目四、五、六
-   每日檢查進度，提前 2 天完成核心功能
-   準備最小可行產品（MVP）版本

----------

## 🎯 成功標準

### 基本標準（60 分）

-   ✅ Qt 介面正常顯示，攝影機畫面流暢
-   ✅ 4 個快捷鍵全部可用
-   ✅ 4 顆 LED 可控制（閃爍+恆亮）
-   ✅ 光敏電阻讀取正常，自動照明運作

### 進階標準（80 分）

-   ✅ YOLO 或顏色偵測可運作
-   ✅ 人臉識別準確率 > 70%
-   ✅ Kernel Driver 可讀寫日誌

### 優秀標準（90+ 分）

-   ✅ YOLO 準確率 > 85%
-   ✅ 雙重解鎖流程完整運作
-   ✅ Discord 推播即時且穩定
-   ✅ Demo 展示流暢無卡頓
-   ✅ 報告內容詳實且專業

----------

## 📚 參考資源

### 技術文件

-   YOLOv4 官方倉庫：https://github.com/AlexeyAB/darknet
-   face_recognition 文檔：https://face-recognition.readthedocs.io/
-   Discord.py 文檔：https://discordpy.readthedocs.io/
-   Qt for Python：https://doc.qt.io/qtforpython/
-   Jetson GPIO：https://github.com/NVIDIA/jetson-gpio

### 教學資源

-   YOLO 訓練教學：https://github.com/AlexeyAB/darknet#how-to-train-to-detect-your-custom-objects
-   Kernel Driver 入門：Linux Device Drivers, 3rd Edition
-   SPI 通訊教學：https://learn.sparkfun.com/tutorials/serial-peripheral-interface-spi

----------

## 🏁 總結

這份計畫書整合了：

-   ✅ 完整的情境設計（符合真實應用）
-   ✅ 詳細的技術方案（覆蓋所有評分項目）
-   ✅ 明確的 4 人分工（可並行開發）
-   ✅ 清楚的接口定義（降低整合風險）
-   ✅ 完善的時間規劃（2 週衝刺計畫）
-   ✅ 充足的風險應對（確保專案成功）

**核心優勢：**

1.  **技術深度**：YOLO + 人臉識別 + Kernel Driver，展現完整技術棧
2.  **實用價值**：真實的智慧門禁應用，不是玩具專案
3.  **創新亮點**：雙重解鎖機制，符合保全系統邏輯
4.  **展示效果**：視覺化回饋清楚，Demo 有戲劇性

**預期成果：**

-   基本分 60% + 進階分 30% + 報告分 10% = **滿分 100 分**

**最後提醒：**

-   時間管理最重要：嚴格遵守每日任務計畫
-   溝通是關鍵：每天晚上開站立會議
-   接口先行：定義清楚才開始寫程式
-   測試充分：不要等到最後才整合

加油！相信你們能完成這個有野心的專案！🚀